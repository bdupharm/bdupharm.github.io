<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Write a Babel Plugin in 5 Minutes · A Pharmacist's Adventures in Software Engineering</title><meta name="description" content="Write a Babel Plugin in 5 Minutes - Bo Du"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://www.linkedin.com/in/bo-du-pharmd-76b29371" target="_blank" class="nav-list-link">LINKEDIN</a></li><li class="nav-list-item"><a href="https://github.com/bdupharm" target="_blank" class="nav-list-link">GITHUB</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">Write a Babel Plugin in 5 Minutes</h1><div class="post-info">Jul 6, 2016</div><div class="post-content"><p>So you want to write a babel plugin… Let’s start with some background before jumping into the fray.</p>
<h4 id="How-does-babel-work"><a href="#How-does-babel-work" class="headerlink" title="How does babel work?"></a>How does babel work?</h4><p>Babel is a transpiler that transpiles javascript code that you write (ES6, JSX) into javascript code that the browser understands. It does so in three steps:</p>
<ol>
<li>Parser - babel uses babylon as a javascript parser which parses input code into an abstract syntax tree (AST)</li>
<li>Transformer - babel plugins operate on the AST by transforming it into another AST</li>
<li>Generator - babel’s generator generates browser friendly JS code from the final AST</li>
</ol>
<a id="more"></a>
<h4 id="How-do-babel-plugins-work"><a href="#How-do-babel-plugins-work" class="headerlink" title="How do babel plugins work?"></a>How do babel plugins work?</h4><p>Babel plugins utilize the <a href="https://sourcemaking.com/design_patterns/visitor" target="_blank" rel="external">visitor design pattern</a>. You define visitors for the AST node types that you want to manipulate.</p>
<h4 id="Cool-let’s-stare-at-some-code-now"><a href="#Cool-let’s-stare-at-some-code-now" class="headerlink" title="Cool, let’s stare at some code now."></a>Cool, let’s stare at some code now.</h4><p>For example, let’s take a look at <a href="https://github.com/bdupharm/babel-plugin-remove-object-properties" target="_blank" rel="external">this plugin</a> I wrote for work. We wanted to add extra tags to react elements for testing purposes in our <code>React.JS</code> web app. (If you are not familiar with <code>JSX</code> look <a href="https://facebook.github.io/react/docs/jsx-in-depth.html" target="_blank" rel="external">here</a>.</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;div</span><br><span class="line">    data-id=<span class="string">"test"</span>&gt;</span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>We want to create a visitor for AST nodes of type <code>ObjectProperty</code> and remove any node with a name that matches <code>data-*</code>.</p>
<p>The code for this would look like this:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">"use strict"</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        visitor: &#123;</span><br><span class="line">            ObjectProperty: <span class="function"><span class="keyword">function</span> <span class="title">ObjectProperty</span>(<span class="params">path, state</span>) </span>&#123;</span><br><span class="line">                <span class="comment">/**</span><br><span class="line">                 * Define a visitor for nodes of type `ObjectProperty`.</span><br><span class="line">                 * Nodes w/ property names that match a specified regex will be removed.</span><br><span class="line">                 *</span><br><span class="line">                 * :param path: the path of the visited node</span><br><span class="line">                 * :param state: options that are passed to the plugin</span><br><span class="line">                 *</span><br><span class="line">                 */</span></span><br><span class="line">                <span class="keyword">const</span> regexp = <span class="keyword">new</span> <span class="built_in">RegExp</span>(state.opts.regexp);</span><br><span class="line">                <span class="keyword">if</span> (regexp.test(path.node.key.name) || regexp.test(path.node.key.value)) &#123;</span><br><span class="line">                    path.remove();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Here, we perform a simple remove node operation with <code>path.remove()</code>. The <code>path</code> object has other pragmatically named methods you may find useful:</p>
<ul>
<li>Replacing a node : <code>path.replaceWith();</code></li>
<li>Replacing a node w/ multiple nodes: <code>path.replaceWithMultiple();</code></li>
<li>Replacing a node w/ source string: <code>path.replaceWithSourceString();</code></li>
<li>Inserting a sibling node: <code>path.insertBefore();</code> and <code>path.insertAfter();</code></li>
</ul>
<p>If you would like to perform more complex operations like creating new nodes, take a look at the <code>babel-types</code> documentation located <a href="https://github.com/babel/babel/tree/master/packages/babel-types" target="_blank" rel="external">here</a>. <code>babel-types</code> has methods to construct nodes of various types.</p>
<h4 id="How-do-I-publish-my-plugin-and-or-include-it-in-my-project"><a href="#How-do-I-publish-my-plugin-and-or-include-it-in-my-project" class="headerlink" title="How do I publish my plugin and/or include it in my project?"></a>How do I publish my plugin and/or include it in my project?</h4><p>Your module name must be in the format of <code>babel-plugin-*</code> where the <code>*</code> is the name of your plugin. I’m assuming that you know how to bootstrap a npm module project.<br>Once you’re finished, just publish your module with <code>npm publish</code>.</p>
<p>Now just run <code>npm i babel-plugin-* --save-dev</code>, where <code>*</code> is the name of the plugin you just published, inside your project folder.</p>
<p>Lastly, just add the plugin to your <code>.babelrc</code> file. The one thing I would note here is that <code>{ &quot;regexp&quot;: &quot;data-*&quot; }</code> is the <code>state.opts</code> object passed into <code>function ObjectProperty(path, state) {}</code> above.<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"plugins"</span>: [[<span class="string">"remove-object-properties"</span>, &#123; <span class="string">"regexp"</span>: <span class="string">"data-*"</span> &#125;]]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
</div></article></div><div class="about-me"><img src="/portrait.jpg"><div class="description">Hi, I'm a software engineer and pharmacist currently working at Truveris, a health IT startup in NYC. At work, I focus on building the back-end infrastructure while weaving in and out of front-end projects.</div></div></section><footer><div class="paginator"><a href="/2016/07/12/Unable-to-Verify-IPhone-Developer-Apps/" class="prev">上一篇</a><a href="/2016/06/27/Using-Forked-NPM-Modules/" class="next">下一篇</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'bdupharm';
var disqus_identifier = '2016/07/06/Write-a-Babel-Plugin-iin-5-Minutes/';
var disqus_title = 'Write a Babel Plugin in 5 Minutes';
var disqus_url = 'http://blog.bodu.io/2016/07/06/Write-a-Babel-Plugin-iin-5-Minutes/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//bdupharm.disqus.com/count.js" async></script><div class="copyright"><p>© 2016 <a href="http://blog.bodu.io">Bo Du</a>, unless otherwise noted.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-76488168-1",'auto');ga('send','pageview');</script></body></html>